// ***************************************************************************
// Copyright (c) 2017, Industrial Logic, Inc., All Rights Reserved.
//
// This code is the exclusive property of Industrial Logic, Inc. It may ONLY be
// used by students during Industrial Logic's workshops or by individuals
// who are being coached by Industrial Logic on a project.
//
// This code may NOT be copied or used for any other purpose without the prior
// written consent of Industrial Logic, Inc.
// ****************************************************************************

var tape = require('tape')
var genfun = require('./')

tape('generate add function', function(t) {
  var fn = genfun()
    ('function add(n) {')
      ('return n + %d', 42)
    ('}')

  t.same(fn.toString(), 'function add(n) {\n  return n + 42\n}', 'code is indented')
  t.same(fn.toFunction()(10), 52, 'function works')
  t.end()
})

tape('generate function + closed variables', function(t) {
  var fn = genfun()
    ('function add(n) {')
      ('return n + %d + number', 42)
    ('}')

  var notGood = fn.toFunction()
  var good = fn.toFunction({number:10})

  try {
    notGood(10)
    t.ok(false, 'function should not work')
  } catch (err) {
    t.same(err.message, 'number is not defined', 'throws reference error')
  }

  t.same(good(11), 63, 'function with closed var works')
  t.end()
})
