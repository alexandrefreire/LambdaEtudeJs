// ***************************************************************************
// Copyright (c) 2017, Industrial Logic, Inc., All Rights Reserved.
//
// This code is the exclusive property of Industrial Logic, Inc. It may ONLY be
// used by students during Industrial Logic's workshops or by individuals
// who are being coached by Industrial Logic on a project.
//
// This code may NOT be copied or used for any other purpose without the prior
// written consent of Industrial Logic, Inc.
// ****************************************************************************

var fs = require('fs')
var path = require('path')
var zlib = require('zlib')

var tap = require('tap')

var tar = require('../tar.js')

var file = path.join(__dirname, 'cb-never-called-1.0.1.tgz')
var target = path.join(__dirname, 'tmp/extract-test')

tap.test('preclean', function (t) {
  require('rimraf').sync(__dirname + '/tmp/extract-test')
  t.pass('cleaned!')
  t.end()
})

tap.test('extract test', function (t) {
  var extract = tar.Extract(target)
  var inp = fs.createReadStream(file)

  inp.pipe(zlib.createGunzip()).pipe(extract)

  extract.on('error', function (er) {
    t.equal(er.message, 'unexpected eof', 'error noticed')
    t.end()
  })

  extract.on('end', function () {
    t.fail('shouldn\'t reach this point due to errors')
    t.end()
  })
})
